# سیستم دفاتر سه گانه حسابداری

## نمای کلی سیستم

این سیستم شامل سه دفتر اصلی حسابداری است که به صورت یکپارچه با سیستم بانکی و ساختار کدینگ حساب‌ها طراحی شده است:

### 1. دفتر روزنامه (Daybook)
- **هدف**: ثبت تمام تراکنش‌های مالی به صورت روزانه
- **ویژگی‌ها**:
  - ثبت سندهای حسابداری با سیستم دوطرفه
  - اعتبارسنجی توازن بدهکار و بستانکار
  - جستجو و فیلتر بر اساس تاریخ و توضیحات
  - چاپ و خروجی گزارشات
  - مدیریت شماره سند و مراجع

### 2. دفتر کل (General Ledger)
- **هدف**: خلاصه‌سازی تمام حساب‌ها و نمایش موجودی نهایی
- **ویژگی‌ها**:
  - نمایش خلاصه تمام حساب‌ها
  - محاسبه موجودی اولیه، بدهکار، بستانکار و موجودی نهایی
  - نمایش جزئیات تراکنش‌های هر حساب
  - فیلتر بر اساس نوع حساب و تاریخ
  - نمایش ترازنامه و صورت سود و زیان

### 3. دفتر معین (Subsidiary Ledger)
- **هدف**: مدیریت حساب‌های تفصیلی مشتریان، پیمانکاران و تأمین‌کنندگان
- **ویژگی‌ها**:
  - تفکیک بر اساس نوع حساب (مشتری، پیمانکار، تأمین‌کننده)
  - نمایش جزئیات تراکنش‌های هر طرف حساب
  - محاسبه مطالبات و بدهی‌ها
  - نمایش حساب‌های مرتبط

## ساختار کدینگ حساب‌ها

### کدهای اصلی:
- **1000-1999**: دارایی‌ها
  - 1100: صندوق
  - 1200: بانک‌ها
  - 1300: حساب‌های دریافتنی
  - 1400: موجودی کالا
  - 1500: دارایی‌های ثابت

- **2000-2999**: بدهی‌ها
  - 2100: حساب‌های پرداختنی
  - 2200: وام‌ها و تسهیلات
  - 2300: پیش‌دریافت‌ها

- **3000-3999**: سرمایه
  - 3100: سرمایه اولیه
  - 3200: سود انباشته
  - 3300: سود سال جاری

- **4000-4999**: درآمدها
  - 4100: درآمد فروش
  - 4200: درآمد خدمات
  - 4300: سایر درآمدها

- **5000-5999**: هزینه‌ها
  - 5100: هزینه‌های عملیاتی
  - 5200: هزینه‌های مالی
  - 5300: هزینه‌های استهلاک

## یکپارچه‌سازی بانکی

### ویژگی‌های سیستم بانکی:
- مدیریت حساب‌های بانکی متعدد
- ثبت تراکنش‌های بانکی (واریز، برداشت، انتقال، تطبیق)
- همگام‌سازی خودکار با دفاتر حسابداری
- نمایش موجودی لحظه‌ای حساب‌های بانکی
- ارتباط با حساب‌های مرتبط در سیستم حسابداری

## API Endpoints

### دفاتر حسابداری:
- `GET /api/accounting/journal-entries` - دریافت سندهای دفتر روزنامه
- `POST /api/accounting/journal-entries` - ثبت سند جدید
- `GET /api/accounting/ledgers` - دریافت اطلاعات دفتر کل
- `GET /api/accounting/subsidiary-ledgers` - دریافت اطلاعات دفتر معین

### حساب‌ها:
- `GET /api/accounting/accounts` - دریافت لیست حساب‌ها
- `POST /api/accounting/accounts/initialize-comprehensive` - ایجاد چارت حساب جامع

### بانک‌ها:
- `GET /api/accounting/banks` - دریافت لیست بانک‌ها
- `POST /api/accounting/banks` - ثبت بانک جدید
- `GET /api/accounting/banks/[id]/transactions` - دریافت تراکنش‌های بانکی

## ویژگی‌های کلیدی سیستم

### 1. سیستم دوطرفه (Double-Entry Bookkeeping)
- تمام تراکنش‌ها به صورت خودکار در دو طرف بدهکار و بستانکار ثبت می‌شوند
- اعتبارسنجی خودکار توازن حساب‌ها
- جلوگیری از ثبت تراکنش‌های نامتوازن

### 2. ساختار سلسله‌مراتبی حساب‌ها
- پشتیبانی از 4 سطح حساب (کل، معین، تفصیلی، فرعی)
- کدینگ منظم و قابل فهم
- امکان ایجاد حساب‌های فرعی نامحدود

### 3. گزارش‌گیری پیشرفته
- گزارش‌های لحظه‌ای از وضعیت مالی
- امکان فیلتر و جستجو در تمام سطوح
- خروجی چاپی و دیجیتال

### 4. امنیت و کنترل دسترسی
- احراز هویت کاربران
- کنترل دسترسی بر اساس نقش
- ثبت تمام عملیات در لاگ سیستم

## نحوه استفاده

### 1. راه‌اندازی اولیه:
```bash
# ایجاد چارت حساب جامع
POST /api/accounting/accounts/initialize-comprehensive
{
  "projectId": "project-id"
}
```

### 2. ثبت تراکنش:
```bash
# ثبت سند در دفتر روزنامه
POST /api/accounting/journal-entries
{
  "projectId": "project-id",
  "date": "2024-01-01",
  "description": "فروش کالا",
  "entries": [
    {
      "accountId": "bank-account-id",
      "debit": 1000000
    },
    {
      "accountId": "sales-account-id", 
      "credit": 1000000
    }
  ]
}
```

### 3. مشاهده گزارش‌ها:
- مراجعه به صفحه `/accounting/books/[projectId]`
- انتخاب تب مورد نظر (روزنامه، کل، معین، بانک)
- استفاده از فیلترها و جستجو

## مزایای سیستم

1. **یکپارچگی**: تمام دفاتر به صورت هماهنگ کار می‌کنند
2. **دقت**: سیستم دوطرفه از خطاهای حسابداری جلوگیری می‌کند
3. **شفافیت**: امکان ردیابی کامل تمام تراکنش‌ها
4. **انعطاف**: قابلیت تنظیم و توسعه بر اساس نیاز
5. **کاربری آسان**: رابط کاربری ساده و قابل فهم
6. **گزارش‌گیری**: امکان تولید گزارش‌های متنوع و دقیق

این سیستم به گونه‌ای طراحی شده که نیازهای حسابداری پروژه‌های مختلف را پوشش دهد و امکان مدیریت مالی دقیق و حرفه‌ای را فراهم کند.
